<UserControl x:Class="desktop_app.Views.RoomView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="650" d:DesignWidth="1200"
             Style="{StaticResource UserControlBase}">


    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <Grid Margin="22">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- ================= HEADER ================= -->
                <Border Grid.Row="0"
                        Style="{StaticResource HeaderWrapper}">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Título + botón crear (en la misma fila) -->
                        <DockPanel Grid.Row="0" LastChildFill="False">

                            <TextBlock DockPanel.Dock="Left"
                                       Text="Ventana de Habitaciones"
                                       Style="{StaticResource HeaderMainTitle}"/>

                            <!-- Botón crear (pequeño, como en la foto) -->
                            <Button DockPanel.Dock="Right"
                                    Content=" + Crear habitación"
                                    Style="{StaticResource HeaderNavigateButton}"
                                     Command="{Binding GoCreateRoomCommand}"/>
                        </DockPanel>

                        <!-- Card blanca de filtros -->
                        <Border Grid.Row="1"
                                Background="#F7FAFD"
                                CornerRadius="14"
                                Padding="12"
                                Margin="0,14,0,0">

                            <!--
                               WrapPanel: intenta todo en 1 fila.
                               Si no cabe, baja automáticamente a 2ª fila (o más si tu ventana es muy estrecha).
                               Con tamaños compactos normalmente quedará en 2 filas máximo.
                            -->
                            <DockPanel LastChildFill="True">

                                <!-- Botones a la derecha (siempre visibles) -->
                                <StackPanel DockPanel.Dock="Right"
                                            Orientation="Horizontal"
                                            VerticalAlignment="Bottom"
                                            Margin="12,0,0,0">
                                    <Button Style="{StaticResource ClearFiltersBtn}"
                                            Content="Quitar filtros"
                                            Command="{Binding ClearFiltersCommand}"
                                            Height="32"
                                            Padding="14,0"
                                            FontSize="13"
                                            Margin="0,0,20,0"/>
                                    <Button Style="{StaticResource SaveBtn}"
                                            Content="Buscar"
                                            Command="{Binding SearchCommand}"
                                            Height="32"
                                            Padding="16,0"/>
                                </StackPanel>

                                <!-- CONTENIDO FILTRO (se rompe en 2 filas si no cabe) -->
                                <WrapPanel Orientation="Horizontal"
                                           VerticalAlignment="Bottom"
                                           ItemHeight="56">

                                    <!-- Tipo -->
                                    <StackPanel Width="100" Margin="0,0,14,8">
                                        <TextBlock Text="Tipo:" FontWeight="SemiBold" FontSize="12" Margin="2,0,0,6"/>
                                        <ComboBox Height="20"
                                                  Padding="10,0"
                                                  Background="#F3F5F8"
                                                  BorderBrush="#E6E8EF"
                                                  BorderThickness="1"
                                                  SelectedValue="{Binding Type, UpdateSourceTrigger=PropertyChanged}"
                                                  SelectedValuePath="Content">
                                            <ComboBoxItem Content="Todos"/>
                                            <ComboBoxItem Content="single"/>
                                            <ComboBoxItem Content="double"/>
                                            <ComboBoxItem Content="suite"/>
                                            <ComboBoxItem Content="family"/>
                                        </ComboBox>
                                    </StackPanel>

                                    <!-- Huéspedes -->
                                    <StackPanel Width="100" Margin="0,0,14,8">
                                        <TextBlock Text="Huéspedes:" FontWeight="SemiBold" FontSize="12" Margin="2,0,0,6"/>
                                        <TextBox Height="20"
                                                 Padding="10,0"
                                                 Background="#F3F5F8"
                                                 BorderBrush="#E6E8EF"
                                                 BorderThickness="1"
                                                 Text="{Binding GuestsText, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>

                                    <!-- Min -->
                                    <StackPanel Width="100" Margin="0,0,14,8">
                                        <TextBlock Text="Min €:" FontWeight="SemiBold" FontSize="12" Margin="2,0,0,6"/>
                                        <TextBox Height="20"
                                                 Padding="10,0"
                                                 Background="#F3F5F8"
                                                 BorderBrush="#E6E8EF"
                                                 BorderThickness="1"
                                                 Text="{Binding MinPriceText, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>

                                    <!-- Max -->
                                    <StackPanel Width="100" Margin="0,0,18,8">
                                        <TextBlock Text="Max €:" FontWeight="SemiBold" FontSize="12" Margin="2,0,0,6"/>
                                        <TextBox Height="20"
                                                 Padding="10,0"
                                                 Background="#F3F5F8"
                                                 BorderBrush="#E6E8EF"
                                                 BorderThickness="1"
                                                 Text="{Binding MaxPriceText, UpdateSourceTrigger=PropertyChanged}"/>
                                    </StackPanel>

                                    <!-- Checks (en bloque, se adaptan) -->
                                    <StackPanel Orientation="Horizontal"
                                                VerticalAlignment="Bottom"
                                                Margin="0,0,25,17">
                                        <CheckBox Content="Solo disponibles"
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,14,0"
                                                  IsChecked="{Binding OnlyAvailable}"/>
                                        <CheckBox Content="Cama extra"
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,14,0"
                                                  IsChecked="{Binding HasExtraBed}"/>
                                        <CheckBox Content="Con cuna"
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,14,0"
                                                  IsChecked="{Binding HasCrib}"/>
                                        <CheckBox Content="Con oferta"
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,0,0"
                                                  IsChecked="{Binding HasOffer}"/>
                                    </StackPanel>

                                    <!-- Buscar habitación (campo largo) -->
                                    <StackPanel Width="200" Margin="0,0,0,8">
                                        <TextBlock Text="Extras:"  FontSize="12" FontWeight="SemiBold" Margin="2,0,0,6"/>
                                        <TextBox Height="20"
                                             Padding="10,0"
                                             Background="#F3F5F8"
                                             BorderBrush="#E6E8EF"
                                             BorderThickness="1"
                                             Text="{Binding ExtrasText, UpdateSourceTrigger=PropertyChanged}"
                                             ToolTip="Buscar habitación..."/>
                                    </StackPanel>

                                </WrapPanel>
                            </DockPanel>
                        </Border>
                    </Grid>
                </Border>

                <!-- ===== Resultados + refrescar ===== -->
                <Grid Grid.Row="1" Margin="0,0,0,14">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding StatusText}"
                               Foreground="#6B7280"
                               VerticalAlignment="Center"/>

                    <Button Grid.Column="1"
                            Style="{StaticResource SaveBtn}"
                            Content="Refrescar"
                            Command="{Binding RefreshCommand}"/>
                </Grid>

                <!-- ===== Cards habitaciones ===== -->
                <Grid Grid.Row="2">
                    <ItemsControl ItemsSource="{Binding Rooms}"
                                  ItemTemplate="{StaticResource RoomCardTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"
                                           ItemWidth="320"
                                           />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </Grid>

            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
